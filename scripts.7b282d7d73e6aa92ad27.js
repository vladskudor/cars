const express=require("express"),MongoClient=require("mongodb").MongoClient,objectId=require("mongodb").ObjectId,app=express(),jsonParser=express.json(),mongoClient=new MongoClient("mongodb://localhost:27017/");let dbClient;function online(){console.log("online")}function offline(){alert("offline")}app.use((function(e,o,n){o.header("Access-Control-Allow-Origin","*"),o.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),o.header("Access-Control-Allow-Methods","GET, PATCH, PUT, POST, DELETE, OPTIONS"),n()})),mongoClient.connect((function(e,o){if(e)return console.log(e);dbClient=o,app.locals.collection=o.db("usersdb").collection("users"),app.listen(3e3,(function(){console.log("The server is waiting for a connection...")}))})),app.get("/api/users",(function(e,o){e.app.locals.collection.find({}).toArray((function(e,n){if(e)return console.log(e);o.send(n)}))})),app.post("/api/users",jsonParser,(function(e,o){if(!e.body)return o.sendStatus(400);const n={email:e.body.email,password:e.body.password,img:e.body.img};e.app.locals.collection.insertOne(n,(function(e,i){if(e)return console.log(e);o.send(n)}))})),app.put("/api/users",jsonParser,(function(e,o){if(!e.body)return o.sendStatus(400);const n=new objectId(e.body._id);e.app.locals.collection.findOneAndUpdate({_id:n},{$set:{email:e.body.email,password:e.body.password}},{returnOriginal:!1},(function(e,n){if(e)return console.log(e);o.send(n.value)}))})),process.on("SIGINT",()=>{dbClient.close(),process.exit()}),window.navigator.onLine?online():offline(),window.addEventListener("online",online),window.addEventListener("offline",offline);