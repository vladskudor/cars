const express=require("express"),MongoClient=require("mongodb").MongoClient,objectId=require("mongodb").ObjectId,app=express(),jsonParser=express.json(),mongoClient=new MongoClient("mongodb://localhost:27017/");let dbClient;function online(){console.log("online")}function offline(){alert("offline")}app.use((function(e,n,o){n.header("Access-Control-Allow-Origin","*"),n.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),n.header("Access-Control-Allow-Methods","GET, PATCH, PUT, POST, DELETE, OPTIONS"),o()})),mongoClient.connect((function(e,n){if(e)return console.log(e);dbClient=n,app.locals.collection=n.db("usersdb").collection("users"),app.listen(3e3,(function(){console.log("The server is waiting for a connection...")}))})),app.get("/api/users",(function(e,n){e.app.locals.collection.find({}).toArray((function(e,o){if(e)return console.log(e);n.send(o)}))})),app.get("/api/users/:id",(function(e,n){const o=new objectId(e.params.id);e.app.locals.collection.findOne({_id:o},(function(e,o){if(e)return console.log(e);n.send(o)}))})),app.post("/api/users",jsonParser,(function(e,n){if(!e.body)return n.sendStatus(400);const o={email:e.body.email,password:e.body.password,img:e.body.img};e.app.locals.collection.insertOne(o,(function(e,i){if(e)return console.log(e);n.send(o)}))})),app.delete("/api/users/:id",(function(e,n){const o=new objectId(e.params.id);e.app.locals.collection.findOneAndDelete({_id:o},(function(e,o){if(e)return console.log(e);n.send(o.value)}))})),app.put("/api/users",jsonParser,(function(e,n){if(!e.body)return n.sendStatus(400);const o=new objectId(e.body._id);e.app.locals.collection.findOneAndUpdate({_id:o},{$set:{email:e.body.email,password:e.body.password}},{returnOriginal:!1},(function(e,o){if(e)return console.log(e);n.send(o.value)}))})),process.on("SIGINT",()=>{dbClient.close(),process.exit()}),window.navigator.onLine?online():offline(),window.addEventListener("online",online),window.addEventListener("offline",offline);